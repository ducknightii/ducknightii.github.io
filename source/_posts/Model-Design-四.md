---
title: 设计模式（四）
date: 2023-04-06 15:05:37
tags: 设计模式
---

### 说明

在此是 规范与重构的简单整理

### 重构

“重构是一种对软件内部结构的改善，目的是在不改变软件的可见行为的情况下，使其更易理解，修改成本更低。”

持续重构

单元测试：代码的可测试性同样是评判代码质量的一个重要标准。

依赖注入是编写可测试性代码的最有效手段。

一些常见的反模式（Anti-Patterns）：
- 未决行为：代码的输出是随机或者说不确定的，例如：跟时间、随机数有关的代码。
```go
package anti_pattern

import "time"

type Demo struct {
	createdAt time.Time
}

func (d *Demo) calAfterDays() int {
	return int(time.Now().Sub(d.createdAt).Hours()/24)  // 与系统时间相关 反模式
}
```
- 全局变量
- 静态方法
- 复杂继承： 多用组合，少用继承
- 高耦合代码


解耦：
1. 封装与抽象
2. 中间层
3. 模块化
4. 很多设计思想原则：单一职责、基于接口而非实现编程、依赖注入、多用组合少用继承、迪米特法则等


### 一些编程规范

#### 命名

#### 注释

做什么、为什么、怎么做 可能还有如何用

#### 代码风格

- 适当的函数/方法大小
- 适当的行代码长度
- 利用空行分割代码块

#### 一些编程技巧

1. 避免函数参数过多
2. 最好不要用参数来控制逻辑
3. 函数要职责单一
4. 避免过深的嵌套
    - 去除不必要的 if/else
    - 提前退出
    - 调整执行顺序
    - 抽象出函数调用
5. 使用解释性变量
    - 常量取代数字
    - 使用变量解释复杂表达式

#### 统一的编程规范


### 评判代码质量的checklist

#### 常规checklist
- 目录设置是否合理、模块划分是否清晰、代码结构是否满足"高内聚、低耦合"
- 是否遵循经典设计原则和设计思想
- 设计模式是否应用适当、是否存在过度设计
- 是否易扩展
- 是否易复用、是否存在重复造轮子
- 是否易测试
- 是否易读/维护、是否遵循编程规范

#### 业务checklist
- 是否满足业务需求
- 异常处理是否完备
- 日志打印、是否方便debug
- 接口是否易用、幂等性、事务性
- 是否并发安全
- 性能问题
- 安全检查



性能计数器demo: https://github.com/ducknightii/cakes/tree/master/design-model/c04/metric
